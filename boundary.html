<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>Municipality Address Check</title>

  <link rel="preconnect" href="https://maps.googleapis.com" crossorigin>
  <link rel="preconnect" href="https://maps.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

  <link href="https://fonts.googleapis.com/css?family=Lato:400,700&display=swap" rel="stylesheet" />

  <style>
    body { font-family: 'Lato', sans-serif; margin: 0; padding: 0; display: flex; flex-direction: column; align-items: center; background-color: #f4f4f9; }
    h1 { font-size: 14px; font-weight: bold; text-align: left; width: 92%; max-width: 420px; margin: 6px auto; }
    .row { width: 92%; max-width: 420px; margin: 8px auto; display: grid; grid-template-columns: 1fr; gap: 8px; }
    .row label { font-size: 14px; font-weight: bold; }
    select, .row input { width: 100%; padding: 10px; font-size: 14px; border: 1px solid #ccc; border-radius: 8px; }
    .row input:focus, select:focus { outline: none; border: 1px solid #0073e6; }
    .row input.error { border-color: #d93025; }
    .map-container { width: 92%; max-width: 420px; height: 420px; margin: 10px auto; border-radius: 12px; overflow:hidden; background:#e5e7eb; }
    #result { margin-top: 10px; font-size: 14px; font-weight: bold; text-align: left; line-height: 1.6; padding: 10px; width: 92%; max-width: 420px; display: none; border-radius: 10px; margin: 10px auto; background: #ecfdf5; color: #065f46; }
    #result.outside { background: #fef2f2; color: #991b1b; }
    .button-container { width: 92%; max-width: 420px; margin: 12px auto; text-align: center; }
    .button { width: 100%; padding: 12px 20px; font-size: 14px; background-color: #22c55e; color: white; border: none; border-radius: 10px; cursor: pointer; text-align: center; }
    .popup { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border: 1px solid #ccc; border-radius: 12px; text-align: left; width: 92%; max-width: 520px; max-height: 90vh; overflow-y: auto; box-shadow: 0 8px 24px rgba(0,0,0,.18); z-index: 1300; }
    .sharebar { display:flex; gap:8px; margin-top:10px; }
    .sharebar a { flex:1; text-align:center; text-decoration:none; color:#fff; padding:10px; border-radius:10px; font-size:13px; }
    .wa{background:#25D366} .sms{background:#111827} .copy{background:#6b7280} .email{background:#2563eb}
    .header-wrapper { display:flex; align-items:center; justify-content:space-between; width:92%; max-width:420px; margin:8px auto 0; }
    #hamburgerMenu { background:none; border:none; font-size:24px; cursor:pointer; color:#111; }
    #menuDropdown { display:none; position:absolute; right:4%; top:48px; background:#fff; border-radius:10px; padding:8px; box-shadow:0 4px 12px rgba(0,0,0,.15); min-width:230px; z-index:1000; }
    #menuDropdown ul { list-style:none; margin:0; padding:0; }
    #menuDropdown li { border-bottom:1px solid #e5e7eb; }
    #menuDropdown li:last-child { border-bottom:0; }
    #menuDropdown a { display:block; padding:10px 12px; color:#111; text-decoration:none; border-radius:6px; }
    #menuDropdown a:hover { background:#f3f4f6; }
      /* Consent alignment fix (mobile-safe) */
    .consent-wrap{ width:92%; max-width:420px; margin:8px auto; display:flex; align-items:flex-start; gap:10px; }
    .consent-wrap input[type="checkbox"]{ margin-top:2px; flex:0 0 auto; }
    .consent-wrap label{ font-size:14px; font-weight:normal; line-height:1.35; text-align:left; flex:1 1 auto; }
  </style>

  <script src="https://unpkg.com/@turf/turf@6/turf.min.js"></script>
</head>
<body>
  <div class="header-wrapper">
    <div style="height:24px;"></div>
    <button id="hamburgerMenu" aria-label="Open menu">‚ò∞</button>
  </div>
  <div id="menuDropdown" role="menu" aria-hidden="true">
    <ul>
      <li><a href="https://registertovoteflorida.gov/home" target="_blank">‚úî Check Voter Status</a></li>
      <li><a href="https://www.vote.org/register-to-vote/" target="_blank">üìù Register to Vote</a></li>
      <li><a href="https://www.miamidade.gov/global/elections/vote-by-mail.page" target="_blank">üì© Request Your Vote-by-Mail Ballot</a></li>
      <li><a href="https://lkt.337.myftpupload.com/login" target="_blank">üîë Login</a></li>
    </ul>
  </div>

  <h1 id="pageTitle">Check if Your Address is Within the Municipality</h1>

  <div class="row">
    <label for="citySelect">Select City:</label>
    <select id="citySelect" aria-label="Select municipality">
      <option value="homestead" selected>Homestead</option>
      <option value="floridacity">Florida City</option>
    </select>
    <input type="text" id="addressInput" placeholder="Enter address here" aria-label="Address" />
  </div>

  <div class="map-container">
    <div id="map-container" style="width:100%;height:100%"></div>
  </div>

  <div id="result" aria-live="polite"></div>

  <div class="row">
    <label for="nameInput">Enter your name:</label>
    <input type="text" id="nameInput" placeholder="Your Name" />
  </div>
  <div class="row">
    <label for="voterCountInput">How many voters at this address?</label>
    <input type="number" id="voterCountInput" placeholder="Number of Voters" min="1" />
  </div>
  <div class="row">
    <label for="phoneNumberInput">Enter your phone number:</label>
    <input type="tel" id="phoneNumberInput" placeholder="(123) 456-7890" inputmode="tel" />
  </div>
  <div class="consent-wrap">
    <input type="checkbox" id="consentInline" />
    <label for="consentInline">I consent to having my name included in campaign materials</label>
  </div>
  <div class="row">
    <label for="signatureInputMain">Your signature:</label>
    <input type="text" id="signatureInputMain" placeholder="Type your full name here" />
  </div>

  <div class="button-container">
    <button id="submitBtn" class="button">Pledge my support</button>
  </div>

  <div id="thankYouPopup" class="popup" role="dialog" aria-modal="true">
    <h2>Thank You for Your Support!</h2>
    <p>Your commitment makes a difference! By pledging your support, you're helping shape the future of our community.</p>
    <h3 style="margin:10px 0 6px;">Next steps</h3>
    <ol style="padding-left:18px; margin:6px 0;">
      <li>Renew/request your Vote-by-Mail ballot.</li>
      <li>Invite 2 friends who live in your city to pledge.</li>
    </ol>
    <div class="sharebar">
      <a href="#" class="wa" id="shareWa">WhatsApp</a>
      <a href="#" class="sms" id="shareSms">SMS</a>
      <a href="#" class="copy" id="shareCopy">Copy link</a>
      <a href="#" class="email" id="shareEmail">Email</a>
    </div>
    <div style="margin-top:12px;display:flex;gap:8px;">
      <button class="button" id="closePopup">Close</button>
    </div>
  </div>

  <script>
    // Hamburger menu toggle
    (function(){
      const btn = document.getElementById('hamburgerMenu');
      const dd = document.getElementById('menuDropdown');
      btn.addEventListener('click', (e)=>{
        e.stopPropagation();
        const open = dd.style.display === 'block';
        dd.style.display = open ? 'none' : 'block';
        dd.setAttribute('aria-hidden', open ? 'true' : 'false');
      });
      document.addEventListener('click', (e)=>{
        if (!dd.contains(e.target) && e.target !== btn){ dd.style.display='none'; dd.setAttribute('aria-hidden','true'); }
      });
    })();

    let map, autocomplete, marker, geocoder;
    let boundaryGeoJSON = null;

    const citySelect = document.getElementById('citySelect');
    const addressInput = document.getElementById('addressInput');
    const resultEl = document.getElementById('result');
    const popup = document.getElementById('thankYouPopup');
    const closePopup = document.getElementById('closePopup');
    const shareEmail = document.getElementById('shareEmail');

    const CITY_CONFIG = {
      homestead: { name:'Homestead', file:'./homestead_boundary.geojson' },
      floridacity: { name:'Florida City', file:'./floridacity_boundary.geojson' }
    };

    async function loadBoundary(city){
      const cfg = CITY_CONFIG[city];
      const res = await fetch(cfg.file);
      const raw = await res.json();
      let feature = raw.type==='FeatureCollection'? raw.features[0] : raw;
      return feature;
    }

    function pointInPolygon(latLng, feature){
      const pt = turf.point([latLng.lng(), latLng.lat()]);
      const g = feature.geometry;
      if(g.type==='Polygon') return turf.booleanPointInPolygon(pt, turf.polygon(g.coordinates));
      if(g.type==='MultiPolygon') return turf.booleanPointInPolygon(pt, turf.multiPolygon(g.coordinates));
      return false;
    }

    function showResult(isInside, cityName){
      resultEl.style.display='block';
      resultEl.classList.toggle('outside', !isInside);
      resultEl.textContent = isInside? `‚úî Address is inside ${cityName}` : `‚ùå Address is not within ${cityName}`;
    }

    function openPopup(){ popup.style.display = 'block'; }
    closePopup.addEventListener('click', ()=> popup.style.display='none');

    function openShare(){
      const cityName = CITY_CONFIG[citySelect.value].name;
      const msg = `Pledge your support if you live in ${cityName}:`;
      const url = location.href.split('#')[0];
      shareEmail.href = `mailto:?subject=Pledge%20for%20${cityName}&body=${encodeURIComponent(msg + ' ' + url)}`;
      popup.style.display='block';
    }

    document.getElementById('submitBtn').addEventListener('click', ()=>{
      openShare();
    });

    async function initMap(){
      map = new google.maps.Map(document.getElementById('map-container'), {
        center:{lat:25.4687,lng:-80.4776},zoom:13,mapTypeControl:false,streetViewControl:false
      });
      autocomplete = new google.maps.places.Autocomplete(addressInput, { types: ['address'], componentRestrictions:{ country:'us' } });
      geocoder = new google.maps.Geocoder();

      // load initial boundary
      boundaryGeoJSON = await loadBoundary(citySelect.value);

      autocomplete.addListener('place_changed', async ()=>{
        const place = autocomplete.getPlace();
        if(place?.geometry){
          if (!marker) marker = new google.maps.Marker({ position: place.geometry.location, map });
          else marker.setPosition(place.geometry.location);
          map.setCenter(place.geometry.location);
          map.setZoom(15);
          boundaryGeoJSON = await loadBoundary(citySelect.value);
          const inside = pointInPolygon(place.geometry.location, boundaryGeoJSON);
          showResult(inside, CITY_CONFIG[citySelect.value].name);
        }
      });

      addressInput.addEventListener('keydown', async (e)=>{
        if(e.key==='Enter'){
          const place = autocomplete.getPlace();
          if(place?.geometry){
            if (!marker) marker = new google.maps.Marker({ position: place.geometry.location, map });
            else marker.setPosition(place.geometry.location);
            map.setCenter(place.geometry.location);
            map.setZoom(15);
            boundaryGeoJSON = await loadBoundary(citySelect.value);
            const inside = pointInPolygon(place.geometry.location, boundaryGeoJSON);
            showResult(inside, CITY_CONFIG[citySelect.value].name);
          } else if(addressInput.value.trim()){
            geocoder.geocode({ address: addressInput.value.trim(), componentRestrictions:{ country:'US' } }, async (results, status)=>{
              if(status==='OK' && results[0]){
                if (!marker) marker = new google.maps.Marker({ position: results[0].geometry.location, map });
                else marker.setPosition(results[0].geometry.location);
                map.setCenter(results[0].geometry.location);
                map.setZoom(15);
                boundaryGeoJSON = await loadBoundary(citySelect.value);
                const inside = pointInPolygon(results[0].geometry.location, boundaryGeoJSON);
                showResult(inside, CITY_CONFIG[citySelect.value].name);
              } else {
                resultEl.style.display='block';
                resultEl.classList.add('outside');
                resultEl.textContent = 'Could not geocode that address. Please select from the suggestions.';
              }
            });
          }
        }
      });

      citySelect.addEventListener('change', async ()=>{
        boundaryGeoJSON = await loadBoundary(citySelect.value);
        resultEl.style.display='none';
      });
    }
  </script>
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAShTpkHyffGlSUWQ9ttWxAVprwj6vUEQo&libraries=places&callback=initMap"></script>
</body>
</html>



















