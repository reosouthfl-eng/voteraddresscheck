<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Homestead Municipality Address Check</title>

  <link href="https://fonts.googleapis.com/css?family=Lato:400,700&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: 'Lato', sans-serif;
      margin: 0; padding: 0;
      display: flex; flex-direction: column; align-items: center;
      background-color: #f4f4f9;
    }
    .header-wrapper {
      display: flex; justify-content: space-between; align-items: center;
      width: 90%; max-width: 400px; margin: 10px auto; padding: 10px 0;
    }
    #hamburgerMenu { background: none; border: none; font-size: 24px; cursor: pointer; color: black; }
    #menuDropdown {
      display: none; position: absolute; background: #f9f9f9; border-radius: 10px; padding: 8px;
      box-shadow: 0 4px 8px rgba(0,0,0,.2); min-width: 230px; top: 60px; right: 5%; z-index: 1000;
    }
    #menuDropdown ul { list-style: none; margin: 0; padding: 0; }
    #menuDropdown li { border-bottom: 1px solid black; }
    #menuDropdown li a { display: block; padding: 12px; color: black; text-decoration: none; border-radius: 5px; }
    #menuDropdown li a:hover { background: #ddd; }

    @media (max-width: 600px) {
      .header-wrapper { width: 95%; padding: 5px 0; }
      #hamburgerMenu { font-size: 20px; }
      #menuDropdown { right: 5%; }
    }

    h1 {
      font-size: 14px; font-weight: bold; text-align: left;
      width: 90%; max-width: 400px; margin: 10px auto;
    }
    .input-container {
      width: 90%; max-width: 400px; margin: 10px auto;
      display: flex; flex-direction: column; align-items: center;
    }
    .input-container label {
      font-size: 14px; font-weight: bold; margin-bottom: 5px; text-align: left; width: 100%;
    }
    .input-container input {
      width: 100%; padding: 10px; margin-bottom: 10px; font-size: 14px;
      border: 1px solid #ccc; border-radius: 5px;
    }
    .input-container input:focus { outline: none; border: 1px solid #0073e6; }
    .input-container input.error { border-color: #d93025; }

    .map-container { width: 90%; max-width: 400px; height: 400px; margin: 20px auto; }
    #result {
      margin-top: 10px; font-size: 14px; font-weight: bold; text-align: left;
      line-height: 1.6; padding: 10px; width: 90%; max-width: 400px; display: none;
      border-radius: 8px; margin: 20px auto; background: #ecfdf5; color: #065f46;
    }
    #result.outside { background: #fef2f2; color: #991b1b; }

    .button-container { width: 90%; max-width: 400px; margin: 20px auto; text-align: center; }
    .button-container button {
      width: 100%; padding: 10px 20px; font-size: 14px; background-color: blue; color: white;
      border: none; border-radius: 5px; cursor: pointer; text-align: center;
    }
    .button-container button.green { background-color: #28a745; }

    .popup {
      display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
      background: white; padding: 20px; border: 1px solid #ccc; border-radius: 10px; text-align: left;
      width: 90%; max-width: 500px; max-height: 90vh; overflow-y: auto;
      box-shadow: 0 4px 6px rgba(0,0,0,.1); z-index: 1000;
    }
    input[type="checkbox"]#consent {
      opacity: 1 !important; display: inline-block !important; width: 20px !important; height: 20px !important;
      background-color: #fff !important; border: 2px solid #007bff !important; cursor: pointer !important;
      visibility: visible !important; z-index: 1000 !important;
    }

    @media (max-width: 600px) {
      .input-container, .button-container, .map-container, #result { width: 95%; }
    }
  </style>

  <!-- Google Translate -->
<script>
  function googleTranslateElementInit() {
    new google.translate.TranslateElement(
      {
        pageLanguage: 'en',
        includedLanguages: 'en,es,ht', // üëà add 'en' so users can switch back
        layout: google.translate.TranslateElement.InlineLayout.SIMPLE
      },
      'google_translate_element'
    );
  }
</script>
<script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

  <script src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

  <!-- Turf.js -->
  <script src="https://unpkg.com/@turf/turf@6/turf.min.js"></script>
</head>
<body>

  <div class="header-wrapper">
    <div id="google_translate_element"></div>
    <button id="hamburgerMenu">‚ò∞</button>
  </div>

  <div id="menuDropdown">
    <ul>
      <li><a href="https://registertovoteflorida.gov/home" target="_blank">‚úî Check Voter Status</a></li>
      <li><a href="https://www.vote.org/register-to-vote/" target="_blank">üìù Register to Vote</a></li>
      <li><a href="https://www.miamidade.gov/global/elections/vote-by-mail.page" target="_blank">üì© Request Your Vote-by-Mail Ballot</a></li>
      <li><a href="https://lkt.337.myftpupload.com/login" target="_blank">üîë Login</a></li>
    </ul>
  </div>

  <h1>Check if Your Address is Within the Municipality of Homestead</h1>

  <div class="input-container">
    <label for="addressInput">Enter your address:</label>
    <input type="text" id="addressInput" placeholder="Enter address here">
  </div>

  <div id="result"></div>

  <div id="map-container" class="map-container"></div>

  <div class="input-container">
    <label for="nameInput">Enter your name:</label>
    <input type="text" id="nameInput" placeholder="Your Name">
  </div>
  <div class="input-container">
    <label for="voterCountInput">How many voters at this address?</label>
    <input type="number" id="voterCountInput" placeholder="Number of Voters" min="1">
  </div>
  <div class="input-container">
    <label for="phoneNumberInput">Enter your phone number:</label>
    <input type="tel" id="phoneNumberInput" placeholder="(123) 456-7890">
  </div>
  <div class="input-container">
    <label for="referralInput">Name of person who referred you:</label>
    <input type="text" id="referralInput" placeholder="Name of person who referred you">
  </div>

  <div class="button-container">
    <button class="green" onclick="validateAndSubmit()">Submit</button>
  </div>

  <!-- Popup -->
  <div id="thankYouPopup" class="popup">
    <h2>Thank You for Your Support!</h2>
    <p>Your commitment makes a difference! By pledging your support, you're standing with Julio Guzman and helping shape the future of Homestead.</p>
    <h3>Make Your Voice Count! Pledge Your Support Today</h3>
    <p>Check the box below and sign to officially pledge your support for Julio Guzman‚Äôs campaign.</p>
    <div class="preference">
      <label for="consent">
        <input type="checkbox" name="consent" id="consent">
        I consent to having my name included in campaign materials
      </label>
    </div>
    <label for="signatureInput">Your Signature:</label>
    <input type="text" id="signatureInput" name="signature" placeholder="Type your full name here">
    <div class="button-container">
      <button id="submitButton" class="green" onclick="handleConfirmation()">Submit</button>
    </div>
  </div>

  <!-- ===== Corrected single script block (do not nest another <script>) ===== -->
  <script>
    // ===== Menu toggle =====
    document.addEventListener("DOMContentLoaded", () => {
      const hamburgerMenu = document.getElementById("hamburgerMenu");
      const menuDropdown = document.getElementById("menuDropdown");
      hamburgerMenu.addEventListener("click", (e) => {
        e.stopPropagation();
        menuDropdown.style.display = menuDropdown.style.display === "block" ? "none" : "block";
      });
      document.addEventListener("click", (e) => {
        if (!menuDropdown.contains(e.target) && !hamburgerMenu.contains(e.target)) {
          menuDropdown.style.display = "none";
        }
      });
    });

    // ===== Phone formatter =====
    const phoneNumberInput = document.getElementById("phoneNumberInput");
    phoneNumberInput.addEventListener("input", (event) => {
      const input = event.target;
      let v = input.value.replace(/\D/g, "").slice(0, 10);
      if (v.length > 6) v = `(${v.slice(0,3)}) ${v.slice(3,6)}-${v.slice(6)}`;
      else if (v.length > 3) v = `(${v.slice(0,3)}) ${v.slice(3)}`;
      input.value = v;
    });

    // ===== City boundaries (multi-city) =====
const cityConfigs = {
  homestead: {
    name: "Homestead, FL",
    file: "./homestead_boundary.geojson",
    color: "#ef4444",
  },
  floridacity: {
    name: "Florida City, FL",
    file: "./floridacity_boundary.geojson", // add this file to your repo
    color: "#3b82f6",
  },
};
let currentCityKey = "homestead";

// ===== Boundary loading (GeoJSON from file) =====
let map, autocomplete, marker;
let boundaryPolygons = [];
let boundaryBounds = null;    // renamed from homesteadBounds
let boundaryGeoJSON = null;   // renamed from homesteadGeoJSON

function toLatLng(path) { return path.map(([lng, lat]) => ({ lat, lng })); }
function clearPolygons() { boundaryPolygons.forEach(p => p.setMap(null)); boundaryPolygons = []; }

function addPolygon(latlngRings, strokeColor) {
  const poly = new google.maps.Polygon({
    paths: latlngRings,
    strokeColor,
    strokeOpacity: 1,
    strokeWeight: 2,
    fillColor: strokeColor,
    fillOpacity: 0.18,
  });
  poly.setMap(map);
  boundaryPolygons.push(poly);
  latlngRings[0].forEach(pt => boundaryBounds.extend(pt));
}

function drawGeoJSON(geojson, strokeColor = "#ef4444") {
  clearPolygons();
  boundaryBounds = new google.maps.LatLngBounds();

  const g = geojson.geometry;
  const add = (coords) => addPolygon(coords.map(r => toLatLng(r)), strokeColor);

  if (g.type === "Polygon") {
    add(g.coordinates);
  } else if (g.type === "MultiPolygon") {
    g.coordinates.forEach(poly => add(poly));
  } else {
    console.warn("Unsupported geometry:", g.type);
  }

  if (!boundaryBounds.isEmpty()) {
    map.fitBounds(boundaryBounds);
    if (autocomplete) autocomplete.setBounds(boundaryBounds);
  }
}
    function repairPolygon(feature) {
      try {
        const unkinked = turf.unkinkPolygon(feature);
        if (unkinked?.features?.length) {
          if (unkinked.features.length === 1) return unkinked.features[0];
          return {
            type: "Feature", properties: {},
            geometry: { type: "MultiPolygon", coordinates: unkinked.features.map(f => f.geometry.coordinates) }
          };
        }
      } catch (e) { console.warn("unkink failed:", e); }
      try { return turf.buffer(feature, 0, { units: "meters" }); }
      catch (e2) { console.warn("buffer(0) failed:", e2); }
      return feature;
    }
    async function loadCityBoundary(cityKey) {
  const cfg = cityConfigs[cityKey];
  if (!cfg) throw new Error("Unknown city key: " + cityKey);

  const res = await fetch(cfg.file, { cache: "no-store" });
  if (!res.ok) throw new Error("Failed to load boundary file: " + cfg.file);

  const raw = await res.json();
  let feature;
  if (raw.type === "FeatureCollection") feature = raw.features[0];
  else if (raw.type === "Feature") feature = raw;
  else feature = { type: "Feature", properties: {}, geometry: raw.geometry || raw };

  // optional repair if needed
  boundaryGeoJSON = repairPolygon(feature);
  drawGeoJSON(boundaryGeoJSON, cfg.color);
}
    // ===== Google Maps init (global; callback must find this) =====
    async function initMap() {
      const mapCenter = { lat: 25.4687, lng: -80.4776 };
      map = new google.maps.Map(document.getElementById("map-container"), {
        center: mapCenter, zoom: 13, mapTypeControl: false, streetViewControl: false
      });

      try { await loadHomesteadGeoJSON(); }
      catch (err) { console.error("GeoJSON load failed:", err); }

      // Autocomplete (keep INSIDE initMap)
      const input = document.getElementById("addressInput");
      autocomplete = new google.maps.places.Autocomplete(input, {
        types: ["address"], componentRestrictions: { country: "us" }
      });
      if (homesteadBounds) autocomplete.setBounds(homesteadBounds);

      autocomplete.addListener("place_changed", () => {
        const place = autocomplete.getPlace();
        if (!place.geometry) { showResult(false, "No details available for that address."); return; }
        displayResults(place.geometry.location);
      });
    }
    // expose for Google callback
    window.initMap = initMap;

    // ===== Check & display =====
    function displayResults(latLng) {
      if (!homesteadGeoJSON) { alert("Boundary not loaded."); return; }
      const point = turf.point([latLng.lng(), latLng.lat()]);
      const g = homesteadGeoJSON.geometry;
      const isInside =
        g.type === "Polygon"
          ? turf.booleanPointInPolygon(point, turf.polygon(g.coordinates), { ignoreBoundary: false })
          : g.type === "MultiPolygon"
          ? turf.booleanPointInPolygon(point, turf.multiPolygon(g.coordinates), { ignoreBoundary: false })
          : false;

      if (!marker) marker = new google.maps.Marker({ position: latLng, map, title: "Location Checked" });
      else marker.setPosition(latLng);
      map.setCenter(latLng);
      map.setZoom(15);

      showResult(isInside);
    }
    function showResult(isInside, override) {
      const el = document.getElementById("result");
      el.style.display = "block";
      el.classList.remove("outside");
      if (override) { el.textContent = override; return; }
      if (isInside) {
        el.innerHTML = `
          <ul style="list-style: disc; padding-left: 18px; margin: 0;">
            <li><strong style="color: #15803d;">‚úî Yes! Your address is in the Municipality of Homestead.</strong></li>
            <li>üìå Please answer the questions below the map.</li>
          </ul>`;
      } else {
        el.classList.add("outside");
        el.innerHTML = `
          <ul style="list-style: disc; padding-left: 18px; margin: 0;">
            <li><strong style="color: #b91c1c;">‚ùå No, the address is not within the Municipality of Homestead.</strong></li>
            <li>Think of 2 people you know in Homestead and share this campaign with them.</li>
            <li>üì¢ <a href="https://yourcampaignlink.com" target="_blank" rel="noopener">Spread the word!</a></li>
          </ul>`;
      }
    }

    // ===== Popup & localStorage =====
    function openPopup(){ document.getElementById("thankYouPopup").style.display = "block"; }
    function closePopup(){ document.getElementById("thankYouPopup").style.display = "none"; }
    function submitVoterData() {
      const userName = document.getElementById("nameInput").value.trim();
      const voterCount = document.getElementById("voterCountInput").value.trim();
      const consent = document.getElementById("consent").checked;
      if (!userName || !voterCount || Number(voterCount) <= 0) {
        alert("Please enter your name and the number of voters at this address."); return false;
      }
      const today = new Date().toISOString().split("T")[0];
      const store = JSON.parse(localStorage.getItem("voterData") || "{}");
      store[today] = store[today] || [];
      store[today].push({ name: userName, count: Number(voterCount), pledged: consent });
      localStorage.setItem("voterData", JSON.stringify(store));
      return true;
    }
    function handleConfirmation() {
      if (!submitVoterData()) return;
      alert("Thank you for pledging your commitment. Remember to request/renew your vote-by-mail ballot on the top right corner of the home page.");
      closePopup();
    }
    function validateAndSubmit() {
      const nameInput = document.getElementById("nameInput");
      const voterCountInput = document.getElementById("voterCountInput");
      const phoneInput = document.getElementById("phoneNumberInput");
      let ok = true;
      [nameInput, voterCountInput, phoneInput].forEach(el => el.classList.remove("error"));
      if (!nameInput.value.trim()) { nameInput.classList.add("error"); ok = false; }
      const count = parseInt(voterCountInput.value, 10);
      if (isNaN(count) || count <= 0) { voterCountInput.classList.add("error"); ok = false; }
      const digits = phoneInput.value.replace(/\D/g, "");
      if (phoneInput.value.trim() && digits.length !== 10) {
        phoneInput.classList.add("error");
        alert("Please enter a valid 10-digit phone number or leave it blank.");
        ok = false;
      }
      if (!ok) return;
      openPopup();
    }
  </script>

  <!-- Google Maps loader: keep this LAST -->
  <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAShTpkHyffGlSUWQ9ttWxAVprwj6vUEQo&libraries=places&callback=initMap">
  </script>
</body>
</html>


